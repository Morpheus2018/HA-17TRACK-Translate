type: markdown
content: |-
  ## <center> Pakete in Zustellung
  ***
    {% set lang = states('input_select.language') %}
    {% set translations = {'en': 'en', 'de': 'de', 'es': 'es', 'fr': 'fr'} %}
    {% set target_lang = translations.get(lang, 'en') %}

    {% if states.sensor.seventeentrack_packages_in_transit.attributes.packages %}
      {% for package in states.sensor.seventeentrack_packages_in_transit.attributes.packages %}
        {% set info_text = states('sensor.seventeentrack_packages_in_transit')|from_json|default("")|from_json|selectattr('tracking_number', 'equalto', package.tracking_number)|map(attribute='info_text')|list|first|default('Status unbekannt') %}
        **{{ package.friendly_name }} ({{ package.tracking_number }}):** {{ info_text }} - {{ package.timestamp }} ({{ package.timestamp | timestamp_custom("%d:%m:%Y %H:%M") }}){% if lang != 'en' %}
        {% set translate_url = 'https://translation.googleapis.com/language/translate/v2' %}
        {% set api_key = 'YOUR_API_KEY_HERE' %}
        {% set response = salt['http.query'](
            translate_url,
            method='POST',
            params={
                'key': api_key,
                'source': 'en',
                'target': target_lang,
                'q': info_text,
            },
            header_dict={
                'Content-Type': 'application/json'
            },
            data=json.dumps({})
        ) %}
        {% if response.status == 200 %}
            - {{ target_lang }}: {{ response['dict']['data']['translations'][0]['translatedText'] }}
        {% else %}
            - Translation Error
        {% endif %}
        {% endif %}
      {% endfor %}
    {% else %}
      Keine Pakete.
    {% endif %}
